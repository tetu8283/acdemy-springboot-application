<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.springbootapplication.mapper.LearningDataMapper">

    <resultMap id="LearningDataResultMap" type="com.spring.springbootapplication.entity.LearningData">
        <id column="id" property="id" />
        <result column="user_id" property="userId" />
        <result column="category_id" property="categoryId" />
        <result column="learning_year" property="learningYear" />
        <result column="learning_month" property="learningMonth" />
        <result column="learning_time" property="learningTime" />
    </resultMap>

    <!-- 学習データを挿入 -->
    <insert id="insertLearningData" parameterType="com.spring.springbootapplication.entity.LearningData">
        INSERT INTO learning_data(user_id, category_id, learning_year, learning_month, learning_time) 
        VALUES(#{userId}, #{categoryId}, #{learningYear}, #{learningMonth}, #{learningTime})
    </insert>

    <!-- すべての学習データを取得 -->
    <select id="findAll" resultMap="LearningDataResultMap">
        SELECT id, user_id, category_id, learning_year, learning_month, learning_time FROM learning_data
    </select>


    <select id="findByUserId" parameterType="Integer" resultMap="LearningDataResultMap">
        SELECT * FROM learning_data WHERE user_id = #{userId}
    </select>

    <select id="findByUserIdAndCategoryIdAndYearAndMonth" parameterType="map" resultMap="LearningDataResultMap">
        SELECT * FROM learning_data WHERE user_id = #{userId} AND category_id = #{categoryId} AND learning_year = #{learningYear} AND learning_month = #{learningMonth}
    </select>

    <!-- learningData更新 -->
    <update id="updateLearningData" parameterType="com.spring.springbootapplication.entity.LearningData">
        UPDATE learning_data
        SET learning_time = #{learningTime}
        WHERE id = #{id}
    </update>

    <!-- カテゴリIDとユーザーIDでlearning_dataを削除 -->
    <delete id="deleteByCategoryIdAndUserId" parameterType="map">
        DELETE FROM learning_data WHERE category_id = #{categoryId} AND user_id = #{userId}
    </delete>
</mapper>
